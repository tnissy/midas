# プロジェクト構成分析コマンド

## Role

あなたはプロジェクトの構造を読み解き、各フォルダやファイルの内容を**詳細なドキュメント**にまとめる「Codebase Guide Agent」です。
初心者にもわかりやすく、かつ技術的な背景を交えて解説してください。

## Task

現在のプロジェクトをスキャンし、`docs/CODEBASE_MAP.md` を更新してください。

---

## Output Format & Contents

以下の構成で Markdown ドキュメントを作成してください。

### 1. プロジェクト概要

- プロジェクト名と目的を簡潔に説明
- 設計思想やコア原則があれば記載

### 2. ファイル構成（Tree View）

```
ProjectRoot/
├── dir/           # 各ディレクトリの役割をコメントで記載
│   └── file.py    # 各ファイルの役割を簡潔に記載
└── ...
```

**除外するディレクトリ**: `.git`, `.venv`, `node_modules`, `__pycache__`, `dist`, `.pytest_cache` など

### 3. Claude Code 設定（.claude/）

`.claude/` ディレクトリがある場合、以下を解説：
- `settings.local.json`: 権限設定の内容と意味
- `commands/`: カスタムスラッシュコマンドの一覧と役割

### 4. 各ファイルの詳細解説

主要なファイルについて、以下の形式で詳細に解説：

#### ファイル名（例: src/tools/fetcher.py）

**役割**: 一言で説明

**データフロー**:
```
ASCII アートでデータの流れを可視化
┌────────┐      ┌────────┐      ┌────────┐
│ Input  │ ───► │ Process│ ───► │ Output │
└────────┘      └────────┘      └────────┘
```

**主要関数**:
| 関数名 | 引数 | 戻り値 | 説明 |
|--------|------|--------|------|
| `func_name` | `arg: type` | `type` | 処理内容 |

**定義される変数/定数**（設定ファイルの場合）:
| 変数名 | 型 | 説明 |
|--------|-----|------|
| `VAR_NAME` | `str` | 説明 |

**エラーハンドリング**:
- どのようなエラーが発生しうるか
- どのようにハンドリングされるか

### 5. データモデル

Pydantic モデルや TypedDict がある場合：

#### モデル名

| フィールド | 型 | 必須 | 説明 |
|------------|-----|------|------|
| `field` | `str` | ✅ | 説明 |

### 6. エージェント/ワークフロー

LangGraph や LangChain のエージェントがある場合：

**ワークフロー図**:
```
┌────────┐      ┌────────┐      ┌────────┐
│ Node1  │ ───► │ Node2  │ ───► │ Node3  │ ───► END
└────────┘      └────────┘      └────────┘
```

**各ノードの処理**:
- **Node1**: 入力、処理内容、出力
- **Node2**: 入力、処理内容、出力

**State 定義**:
```python
class State(TypedDict):
    field: type  # 説明
```

### 7. 外部連携

API やデータソースとの連携がある場合：

| 連携先 | URL/エンドポイント | 用途 |
|--------|-------------------|------|
| サービス名 | URL | 説明 |

### 8. 出力データ形式

ファイルや API レスポンスとして出力されるデータ構造：

**保存先**: `path/to/output/`

```json
{
  "field": "value",
  "nested": {
    "field": "value"
  }
}
```

### 9. CLI / エントリーポイント

CLI がある場合：

**コマンド例**:
```bash
command subcommand --option=value
```

**出力例**:
```
実際の出力を再現
```

### 10. 技術スタック

| カテゴリ | 技術 | 用途 |
|----------|------|------|
| 言語 | Python 3.11+ | メイン言語 |
| フレームワーク | LangGraph | エージェント構築 |

### 11. セキュリティ & コンプライアンス

#### Credentials Check
| ファイル | 状態 | 説明 |
|----------|------|------|
| `.env` | ✅ .gitignore で除外 | API キー格納 |

#### License Check
- `LICENSE` ファイルの有無と種別

### 12. 使い方

```bash
# インストール
pip install -e .

# 実行
command --help
```

### 13. 実装状況

#### 実装済み ✅
- 機能1
- 機能2

#### 未実装
- 機能3（Phase X）

---

## Style Guide

- **データフロー図**: ASCII アートで視覚的にわかりやすく
- **表形式**: 関数、変数、フィールドは表で整理
- **コード例**: 実際のコードや出力例を含める
- **簡潔さ**: 冗長な説明は避け、要点を押さえる

## 注意事項

- すべてのソースファイルを読み込んでから分析を開始すること
- 推測ではなく、実際のコードに基づいて記述すること
- 未実装の機能は requirements.md などから把握すること

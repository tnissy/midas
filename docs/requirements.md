# Midas - 投資情報収集・分析サーバー

## 0. 設計思想・投資哲学（Midas Core Principles）

### 0.1 基本思想

サーバント Midas は、世界・社会・技術の構造変化を継続的に観測し、長期的に価値が集中・移動する地点を見極めるための**投資意思決定支援エージェント群**である。

- 投資対象は「銘柄」ではなく「世の中の変化（構造変化）」である
- 価格は結果であり、判断材料の主軸には置かない
- 平常時は何もしない（Hold をデフォルトとする）
- 売却判断は価格ではなく Thesis（前提条件）の破綻によってのみ行う

### 0.2 想定する投資スタイル

- 長期投資（5〜10年スパン）
- 技術転換・制度転換・行動様式の変化に伴う価値移動への投資
- 王者（Dominant Platform）の優位条件崩壊と次の勝者の特定

---

## 1. システム概要

### 1.1 目的

投資に関する情報を自動収集・整理し、構造変化および前提条件の成立・破綻を継続的に監視することで、長期投資における意思決定を支援する。

### 1.2 対象ユーザー

- 長期資産形成を目的とする個人投資家

### 1.3 機能概要

| 機能 | 内容 |
|------|------|
| **買い調査** | 世の中の変化を調べ、恩恵を受ける企業を特定。企業固有のネガティブ要素（経営者、技術者流出、支配構造等）も確認 |
| **売り調査** | 保有銘柄を管理し、世の中の変化や同業他社の躍進など外部要因によるネガティブ要素を監視 |
| **未来洞察** | ニュースから未来シグナルを抽出し、投資テーマと受益企業を特定 |
| **企業発見** | 未来予測に基づき、実現に重要な役割を果たす企業を特定 |
| **学習** | 株価が急変（1ヶ月で3倍or1/3）した事例を振り返り、背景の構造変化を分析。得られた知見で調査ロジックを改善 |

### 1.4 対象投資商品

- 株式（米国、その他）

### 1.5 情報選別ポリシー

| 区分 | 内容 |
|------|------|
| **収集する** | 技術・制度・行動様式の変化に関わるもの |
| **収集しない** | 株価・相場などの市場ノイズ、決算・人事などの単発イベント、短期的な景気・センチメント情報 |

> **ポイント**: 政府情報は米国とそれ以外を区別する。日本を特別扱いはしない。

---

## 2. 機能要件

### 2.1 企業分析機能（Company Analysis）

- 企業固有のネガティブ要素を分析（経営者の性質、技術者の流出、支配構造、ガバナンス等）
- 財務情報を補助的に用い、前提条件（Thesis）の変化を検知
- 企業が属する構造やテーマとの整合性を評価

### 2.2 ポートフォリオ管理機能（Portfolio Management）

- 保有銘柄およびテーマ構成を管理
- 各投資先の前提条件（Thesis）の状態を管理
- 前提条件の破綻や構造変化を検知
- 売却検討が必要な状態を段階的に提示
- 売却は自動実行せず、人間の判断を前提とする

### 2.3 ニュース監視機能（News Watch）

世の中の構造や前提条件に関係するニュースのみを監視対象とする。

| 区分 | 監視対象 |
|------|----------|
| **米国政府ウォッチ** | 法案・規制・政策・国家戦略 |
| **その他政府ウォッチ** | 米国以外の政府・規制当局の制度変更や政策（日本を特別扱いしない） |
| **新技術ウォッチ** | 技術の実用化、標準化、ボトルネックの移動 |
| **その他ニュースウォッチ** | 上記に属さないが構造や前提条件に影響する情報 |

### 2.4 株式市場監視機能（Market Watch）

- 市場全体の異常や変調を監視
- 価格情報は異常検知や振り返り用途に限定
- 売買判断の直接材料としては使用しない

### 2.5 学習機能（Learning）

- 大きな価格変動（1ヶ月で3倍or1/3）が発生した事例を振り返る
- 背景となった世の中の変化を整理
- 得られた知見を企業分析・ニュース監視・売却判断の改善に反映

### 2.6 未来洞察機能（Future Insight）

- 収集したニュースから「未来シグナル」を抽出
  - 技術シフト、規制変更、行動変容、地政学、プラットフォームシフト等
- 複数のシグナルを統合して「投資テーマ」を合成
- 各テーマに対する受益者（企業・セクター・技術）を特定
- 時間軸（1-2年 / 3-5年 / 5-10年）と確信度を評価

### 2.7 重要企業発見機能（Critical Company Finder）

- 未来予測（例：「EV が主流になる」）を入力として受け取る
- 予測実現に必要な「重要コンポーネント」を分析
  - 技術、インフラ、サービス、素材、規制など
- 各コンポーネントで重要な役割を果たす企業を特定
  - 市場リーダー、挑戦者、ニッチプレイヤー、新興企業
- 競争優位性と確信度を評価
- 投資示唆とリスクを整理

---

## 3. 技術スタック

| カテゴリ | 技術 |
|----------|------|
| 言語 | Python 3.11+ |
| エージェント | LangGraph / LangChain |
| LLM | Google Gemini API |
| 株価取得 | yfinance, finvizfinance |
| HTTP | httpx |
| データモデル | Pydantic |
| データ保存 | JSON ファイル |

---

## 4. データソース

| 種類 | API |
|------|-----|
| 株価 | Yahoo Finance (yfinance) |
| 株式スクリーニング | FINVIZ (finvizfinance) |
| ニュース | RSS Feeds, Google News RSS |
| 政府情報 | 各政府機関 RSS（White House, Congress, SEC, EU, etc.） |

---

## 5. 開発フェーズ

### Phase 1: MVP
- [x] プロジェクト構造のセットアップ
- [x] 株価データ収集（yfinance）
- [x] 株式スクリーニング（FINVIZ）
- [x] 基本的な企業分析機能
- [x] CLI でのレポート出力

### Phase 2: ニュース監視
- [x] ニュース収集エージェント（米国政府）
- [x] ニュース収集エージェント（新技術）
- [x] ニュース収集エージェント（その他政府）
- [x] ニュース収集エージェント（一般ニュース）
- [x] 情報選別フィルタリング（LLM）
- [x] ポートフォリオ管理機能
- [x] 未来洞察エージェント
- [x] 重要企業発見エージェント

### Phase 3: 学習・改善
- [x] 株価急変事例の収集・分析
- [x] 知見のフィードバックループ
- [ ] 通知機能（Slack / LINE）
- [ ] PostgreSQL でのデータ永続化

---

## 6. エージェント関連図

### 6.1 全体アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Midas Agent Architecture                          │
└─────────────────────────────────────────────────────────────────────────────┘

                              【外部データソース】
    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
    │  White House │ │  Tech Blogs  │ │   EU/UK Gov  │ │ Google News  │
    │  Congress    │ │  Google News │ │   各国規制   │ │ 経済メディア │
    │  SEC/USTR    │ │   RSS        │ │   RSS        │ │   RSS        │
    └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘
           │                │                │                │
           ▼                ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        【データ収集レイヤー】                                │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐│
│  │ US Gov News     │ │ Tech News       │ │ Other Gov News  │ │ General     ││
│  │ Watcher         │ │ Watcher         │ │ Watcher         │ │ News Watcher││
│  │ ─────────────── │ │ ─────────────── │ │ ─────────────── │ │ ───────────-││
│  │ • RSS収集       │ │ • RSS収集       │ │ • RSS収集       │ │ • RSS収集   ││
│  │ • LLMフィルタ   │ │ • LLMフィルタ   │ │ • LLMフィルタ   │ │ • LLMフィルタ││
│  │ • 重複排除      │ │ • 重複排除      │ │ • 重複排除      │ │ • 重複排除  ││
│  └────────┬────────┘ └────────┬────────┘ └────────┬────────┘ └──────┬──────┘│
└───────────┼──────────────────┼──────────────────┼────────────────────┼──────┘
            │                  │                  │                    │
            └──────────────────┴─────────┬────────┴────────────────────┘
                                         │
                                         ▼
                            ┌────────────────────────┐
                            │   data/news/*.json     │
                            │   (構造変化ニュース)   │
                            └───────────┬────────────┘
                                        │
                    ┌───────────────────┴───────────────────┐
                    │                                       │
                    ▼                                       ▼
┌─────────────────────────────────────────┐   ┌─────────────────────────────────┐
│       【未来洞察レイヤー】               │   │      【年次展望レイヤー】         │
│  ┌─────────────────────────────────┐   │   │  ┌─────────────────────────┐     │
│  │      Future Insight Agent       │   │   │  │      Farseer            │     │
│  │ ─────────────────────────────── │   │   │  │ ─────────────────────── │     │
│  │ 1. collect: ニュース読込        │   │   │  │ 1. scan: Google News    │     │
│  │ 2. extract_signals: シグナル抽出│   │   │  │    検索で展望記事収集   │     │
│  │ 3. synthesize_themes: テーマ合成│   │   │  │ 2. analyze: 社会変化    │     │
│  │ 4. generate_report: レポート    │   │   │  │    を LLM で分析        │     │
│  │ 5. save: 保存                   │   │   │  │ 3. report: レポート生成 │     │
│  └────────────────┬────────────────┘   │   │  └───────────┬─────────────┘     │
└───────────────────┼─────────────────────┘   └─────────────┼───────────────────┘
                    │                                       │
                    │  ┌────────────────────────────────────┘
                    │  │
                    ▼  ▼
          ┌──────────────────────────────────────────────────────────┐
          │                【企業発見レイヤー】                       │
          │  ┌────────────────────────────────────────────────────┐ │
          │  │          Critical Company Finder                    │ │
          │  │ ─────────────────────────────────────────────────── │ │
          │  │ Input: 未来予測（例: "EV が主流になる"）            │ │
          │  │ 1. decompose: バリューチェーン分解                  │ │
          │  │    → 素材/部品/装置/インフラ/サービス               │ │
          │  │ 2. find_companies: 各層の企業を特定                 │ │
          │  │ 3. synthesize: 投資示唆とリスクを整理               │ │
          │  └────────────────────────────────────────────────────┘ │
          └──────────────────────────────────────────────────────────┘
                                        │
                                        │ 特定された企業
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         【企業分析レイヤー】                                 │
│                                                                             │
│   ┌─────────────────────────────┐     ┌─────────────────────────────┐      │
│   │   Negative Info Watcher     │     │   Price Event Analyzer      │      │
│   │ ─────────────────────────── │     │ ─────────────────────────── │      │
│   │ Input: 企業シンボル (AAPL)  │     │ Input: 企業シンボル (AAPL)  │      │
│   │ 1. fetch: yfinance + 検索  │     │ 1. fetch_price: yfinance    │      │
│   │ 2. filter: キーワード抽出  │     │ 2. find_events: ±5%日次変動 │      │
│   │ 3. analyze: LLM でリスク   │     │ 3. search_news: 前後ニュース│      │
│   │    レベルを評価            │     │ 4. analyze: LLM で原因特定  │      │
│   │ 4. summarize: リスク要約   │     │    (決算/規制/訴訟等)       │      │
│   └──────────────┬──────────────┘     └──────────────┬──────────────┘      │
│                  │                                    │                     │
└──────────────────┼────────────────────────────────────┼─────────────────────┘
                   │                                    │
                   └────────────────┬───────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      【ポートフォリオレイヤー】                              │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │                    Portfolio Analyzer                            │      │
│   │ ─────────────────────────────────────────────────────────────── │      │
│   │ Input: data/portfolio/portfolio.json (保有銘柄)                  │      │
│   │ 1. load: ポートフォリオ読込                                      │      │
│   │ 2. update_prices: yfinance で時価更新                            │      │
│   │ 3. analyze: LLM でポートフォリオ分析                             │      │
│   │    → 集中リスク/セクター分散/個別銘柄評価                        │      │
│   │ 4. save: 分析結果保存                                            │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 データフロー概要

```
┌────────────────────────────────────────────────────────────────────┐
│                     主要データフロー                               │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  [買い調査フロー]                                                  │
│  RSS Sources → News Watchers → Future Insight Agent                │
│                                     ↓                              │
│                              投資テーマ/シグナル                    │
│                                     ↓                              │
│                          Critical Company Finder                   │
│                                     ↓                              │
│                              重要企業リスト                         │
│                                     ↓                              │
│                          Negative Info Watcher (企業精査)          │
│                                                                    │
│  ───────────────────────────────────────────────────────────────  │
│                                                                    │
│  [売り調査フロー]                                                  │
│  Portfolio (保有銘柄) → Portfolio Analyzer                         │
│           ↓                    ↓                                   │
│     Price Event Analyzer    集中リスク/Thesis破綻チェック          │
│           ↓                                                        │
│     株価急変の原因分析                                              │
│                                                                    │
│  ───────────────────────────────────────────────────────────────  │
│                                                                    │
│  [未来展望フロー]                                                  │
│  prediction_monitor → 年次展望記事スキャン → 社会変化の検出        │
│                 ↓                                                  │
│       foresight_to_company_translator (展望に基づく企業探索)       │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### 6.3 エージェント一覧

| エージェント | 役割 | 入力 | 出力 |
|------------|------|------|------|
| **tech_news_watcher** | テクノロジー情報収集 | RSS Feeds | 構造変化ニュース |
| **us_gov_watcher** | 米国政府情報収集 | RSS Feeds | 構造変化ニュース |
| **other_gov_watcher** | 他国政府情報収集 | RSS Feeds | 構造変化ニュース |
| **general_news_watcher** | 一般ニュース収集 | RSS Feeds | 構造変化ニュース |
| **prediction_monitor** | 年次社会変化分析 | Google News | 社会変化レポート |
| **forsight_manager** | 未来シグナル抽出 | 収集ニュース | 投資テーマ/シグナル |
| **foresight_to_company_translator** | 重要企業特定 | 未来予測テキスト | バリューチェーン/企業リスト |
| **company_watcher** | 企業分析 | 企業シンボル | リスクレポート |
| **price_event_analyzer** | 株価変動原因分析 | 企業シンボル | 価格イベント分析 |
| **portfolio_manager** | ポートフォリオ分析 | 保有銘柄データ | 投資提案/リスク評価 |
| **model_calibration_agent** | 株価急変からの学習 | 期間指定 | 学習事例/知見 |


### 6.4 CLI コマンドとエージェントの対応

```bash
# データ収集
midas collect --source all          # 全 News Watcher 実行
midas collect --source us-gov       # us_gov_watcher
midas collect --source tech         # tech_news_watcher

# 未来洞察
midas insight --days 7              # forsight_manager

# 年次展望
midas prediction-monitor scan --year 2026  # prediction_monitor

# 企業発見
midas find-companies "EVが主流になる"  # foresight_to_company_translator

# 企業分析
midas analyze AAPL --mode risk      # company_watcher
midas analyze AAPL --mode price     # price_event_analyzer
midas analyze AAPL --mode full      # 両方実行

# ポートフォリオ
midas portfolio analyze             # portfolio_manager

# 学習
midas learn scan --period month     # model_calibration_agent（急変事例スキャン）
midas learn insights                # 蓄積した知見の表示
midas learn cases                   # 分析済み事例の表示
```
